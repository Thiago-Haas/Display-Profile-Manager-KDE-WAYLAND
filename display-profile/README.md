# Display Profile Manager for KDE Wayland (NVIDIA-friendly)

A simple Bash utility to **save and reapply display configurations** on **Kubuntu / KDE Plasma Wayland**.  
Unlike `xrandr`, this uses [`kscreen-doctor`](https://invent.kde.org/plasma/kscreen) (Plasma’s display tool), so it works reliably on **Wayland** and with **NVIDIA drivers**.

---

## Features
- Save the current display layout (enabled outputs, resolution, refresh, position, scale, rotation).
- Reapply a saved layout with a single command.
- Manage multiple profiles (e.g., `home-desk`, `work-dock`, `projector`).
- Debug view of the current state in JSON.

---

## Requirements
- KDE Plasma 5.20+ (Wayland session).
- `kscreen-doctor` (comes with `plasma-workspace`).
- [`jq`](https://stedolan.github.io/jq/) (for JSON parsing).

Install dependencies on Kubuntu:

```bash
sudo apt install plasma-workspace jq
```

---

## Installation
Clone the repo or copy the script into your `$PATH`:

```bash
mkdir -p ~/bin
cp display-profile ~/bin/
chmod +x ~/bin/display-profile
```

Make sure `~/bin` is in your `$PATH` (add to `~/.bashrc` or `~/.zshrc` if needed).

---

## Usage

```bash
Usage:
  display-profile save <name>   - snapshot current Wayland layout into <name>
  display-profile apply <name>  - reapply saved profile
  display-profile list          - list saved profiles
  display-profile show          - show parsed current state (debug)
```

### Save current layout
```bash
display-profile save home-desk
```
Creates a script under `~/.config/display-profiles/home-desk.sh`.

### Apply saved layout
```bash
display-profile apply home-desk
```

### List profiles
```bash
display-profile list
```

### Debug: show current state
```bash
display-profile show
```

---

## How it works
- Runs `kscreen-doctor -j` to dump the display server’s JSON config.
- Extracts each output’s name, mode, position, scale, and rotation with `jq`.
- Generates a replayable script with `kscreen-doctor output.<name>...` commands.
- Profiles are stored in `~/.config/display-profiles`.

---

## Example

Saving a dual-monitor desktop:
```bash
display-profile save dual-setup
```

Generated script (`~/.config/display-profiles/dual-setup.sh`):
```bash
#!/usr/bin/env bash
set -euo pipefail
# Auto-generated by display-profile on 2025-09-28

kscreen-doctor output.eDP-1.disable
kscreen-doctor output.HDMI-A-1.disable

kscreen-doctor output.eDP-1.mode.1920x1080@60
kscreen-doctor output.eDP-1.position.0,0
kscreen-doctor output.eDP-1.scale.1
kscreen-doctor output.eDP-1.rotation.normal
kscreen-doctor output.eDP-1.enable

kscreen-doctor output.HDMI-A-1.mode.2560x1440@60
kscreen-doctor output.HDMI-A-1.position.1920,0
kscreen-doctor output.HDMI-A-1.scale.1
kscreen-doctor output.HDMI-A-1.rotation.normal
kscreen-doctor output.HDMI-A-1.enable
```

---

## Notes
- Profiles are tied to connector names (`eDP-1`, `HDMI-A-1`), which are stable across reboots.
- Works with NVIDIA proprietary driver under Wayland.
- This doesn’t touch KDE’s GUI display settings; it just replays them.
- You can symlink a profile to a `.desktop` file for one-click switching.

---

## License
MIT
